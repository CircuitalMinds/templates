{% extends 'index.html' %}

{% block content %}
<link href="{{ static['css'] }}/desktop/descktop.css" rel="stylesheet">
<style>
    .window-area {
        background: url("{{ static['images'] }}/desktop/desktop.jpg") center center no-repeat;
        background-size: cover;
    }
    #charm {
        height: calc(100vh - 40px);
        width: 396px;
        background-color: #1F4F5D;
    }
</style>
<body class="m4-cloak">
    <div data-role="charms" data-position="right" id="charm" class="p-4">
        <div class="h-100 d-flex flex-column">
            <div class="charm-top">
                <div class="text-center m-4">
                    <span>{{ title }}</span>
                </div>
                {% for notify in notifies %}
                    {{notify|safe}}
                {% endfor %}
                <div class="text-center m-4">
                    <span>Information</span>
                </div>
                <div class="charm-notify">
                    <span class="icon mif-info"></span>
                    <div class="title">You have a news</div>
                    <div class="content">Our Fractalized World.</div>
                </div>
                <div class="clear mt-4 reduce-1">
                    <span class="place-left c-pointer">Collapse</span>
                    <span class="place-right c-pointer">Clear notifies</span>
                </div>
            </div>
            <div class="charm-bottom mt-auto">
                <div class="d-flex">
                    <div class="charm-tile">
                        <span class="icon mif-tablet-landscape"></span>
                        <span class="caption">Tablet mode</span>
                    </div>
                    <div class="charm-tile">
                        <span class="icon mif-wifi-full"></span>
                        <span class="caption">Network</span>
                    </div>
                    <div class="charm-tile">
                        <span class="icon mif-cog"></span>
                        <span class="caption">Preferences</span>
                    </div>
                    <div class="charm-tile active">
                        <span class="icon mif-rocket"></span>
                        <span class="caption">Fly mode</span>
                    </div>
                </div>
                <div class="d-flex">
                    <div class="charm-tile active">
                        <span class="icon mif-target"></span>
                        <span class="caption">Position</span>
                    </div>
                    <div class="charm-tile">
                        <span class="icon mif-bluetooth"></span>
                        <span class="caption">Not connected</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="desktop">
        <div class="window-area">
        <div class="grid">
        {% for directory in directories %}
            <div class="row m-3 text-center">
                <a class="cell-md-1 flex-align-self-start fg-white fg-teal-hover"
                   style="text-decoration: none;"
                   onclick="windowApps.storage_app('{{directory['name']}}');"
                   id="{{ directory['name'] }}">
                <span class="{{ directory['icon'] }}"></span><br>{{ directory['name'] }}</a>
            </div>
        {% endfor %}
        </div>
        </div>
        <div class="task-bar">
            <div class="task-bar-section">
                <button class="task-bar-item" id="start-menu-toggle"><span class="mif-windows"></span></button>
                <div class="start-menu" data-role="dropdown" data-toggle-element="#start-menu-toggle">
                    <div class="start-menu-inner">
                        <div class="explorer">
                            <ul class="v-menu w-100 bg-brandColor2 fg-white">
                                {% for app in apps %}
                                    <li>
                                        <a onclick="windowApps['{{app['name']}}']();" >{{ app['caption'] }}</a>
                                    </li>
                                {% endfor %}
                                <li><a onclick="openStart();">Start</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="task-bar-section tasks"></div>
            <div class="task-bar-section system-tray ml-auto">
                <button class="task-bar-item" id="open-charm" onclick="openCharm()"><span class="mif-comment"></span></button>
                <span style="line-height: 40px;" class="pr-4">
                    <span data-role="clock" class="w-auto fg-white reduce-1" data-show-date="false"></span>
                </span>
            </div>
        </div>
    </div>
    <script src="{{ metro['js']['src'] }}" ></script>
    <script src="{{static['js']}}/desktop/desktop.js"></script>
    <script src="{{static['js']}}/desktop/music_app.js"></script>
    <script src="{{static['js']}}/desktop/console_app.js"></script>
    <script src="{{static['js']}}/desktop/storage_app.js"></script>

<script>
    var Apps = {{ json_data|safe }};
    var windowApps = {
        music_app: openMusicApp,
        console_app: openConsoleApp,
        storage_app: openDirectory,
        chat_app: openChatApp,
        inbox_app: openInboxApp
    };
    Desktop.setup();

    function openStart () {
        var getTemplate = $.get( "/start" );
        getTemplate.done( function ( data ) {
            var template = data['template'];
            var w = Desktop.createWindow({
                resizeable: true,
                draggable: true,
                customButtons: Apps.storage_app.buttons,
                width: "100%",
                icon: "<span class='mif-windows'></span>",
                title: "Start",
                content: "<div class='p-2'>" + template + "</div>",
                clsContent: "bg-dark fg-teal"
            });
        });
    };

    function openInboxApp () {
        var getTemplate = $.get( "/inbox_app" );
        getTemplate.done( function ( data ) {
            var template = data['template'];
            var w = Desktop.createWindow({
                resizeable: true,
                draggable: true,
                customButtons: Apps.storage_app.buttons,
                width: "100%",
                icon: "<span class='mif-windows'></span>",
                title: "Inbox",
                content: "<div class='p-2'>" + template + "</div>",
                clsContent: "bg-dark fg-teal"
            });
        });
    };

    function openChatApp () {
        var getTemplate = $.get( "/chat_app" );
        getTemplate.done( function ( data ) {
            var template = data['template'];
            var w = Desktop.createWindow({
                resizeable: true,
                draggable: true,
                customButtons: Apps.storage_app.buttons,
                width: "100%",
                icon: "<span class='mif-windows'></span>",
                title: "Chat",
                content: "<div class='p-2'>" + template + "</div>",
                clsContent: "bg-dark fg-teal"
            });
        });
    };
</script>
</body>
{% endblock %}